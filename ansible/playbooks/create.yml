---

- name: Create cluster
  hosts: all
  become: yes
  roles:
    - { role: prepare, tags: prepare }
    - { role: K3s, tags: K3s }
    - { role: certificates, tags: certificates }
    - { role: dashboard, tags: dashboard }
    - { role: pihole, tags: pihole }
    # - { role: monitor, tags: monitor }
    - { role: rss, tags: rss }
    - { role: cleanup, tags: cleanup }
  environment:
    KUBECONFIG: /etc/rancher/k3s/k3s.yaml

  vars_prompt:
    - name: pihole_pwd
      prompt: Set pihole dashboard password
      default: "default"
      private: yes
      confirm: yes

  tasks:
  - name: Kubernetes dashboard admin token
    debug:
      msg: "{{ dashboard_token.stdout }}"

  - name: Create complete
    debug:
      msg: "RPi Home Server is Ready!"
